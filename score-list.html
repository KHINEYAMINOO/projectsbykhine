<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>スコア一覧（IDとスコアのみ）</title>
 
</head>
<style>
  /* ===== ベース設定 ===== */
body {
  margin: 0;
  font-family: "Noto Sans JP", system-ui, -apple-system, Roboto, sans-serif;
  background: linear-gradient(135deg, #e0f7fa, #fff);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #333;
}

/* ===== カード風メインボックス ===== */
.glass-box {
  background: rgba(255, 255, 255, 0.8);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
  border-radius: 16px;
  padding: 2rem;
  width: min(90%, 800px);
  backdrop-filter: blur(12px);
}

/* ===== 見出し ===== */
h1 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: #355C7D;
  font-weight: 600;
}

/* ===== テーブル全体 ===== */
.table {
  width: 100%;
  border-collapse: collapse;
  font-size: 1rem;
  background: white;
  border-radius: 12px;
  overflow: hidden;
}

/* ===== テーブル見出し ===== */
.table thead {
  background: #355C7D;
  color: #fff;
}
.table th {
  padding: 0.8rem;
  text-align: left;
  font-weight: 500;
  letter-spacing: 0.05em;
}

/* ===== テーブル本文 ===== */
.table td {
  padding: 0.8rem;
  border-bottom: 1px solid #eee;
}

/* ===== 順位の列を太字に ===== */
.table td:first-child {
  font-weight: 700;
  color: #355C7D;
}

/* ===== Hover時の行色 ===== */
.table tbody tr:hover {
  background-color: #f1f8e9;
  transition: background-color 0.2s;
}

/* ===== スコア列（基本はグレー） ===== */
.table td.score-cell {
  text-align: right;
  font-weight: 600;
  color: #444;
}

/* ===== トップ3だけ赤にする ===== */
.table tbody tr:nth-child(-n+3) td.score-cell {
  color: black;
}

/* ===== Applicant IDリンク ===== */
.table tbody a:link,
.table tbody a:visited {
  color:black;
  text-decoration: none;
  font-weight: 600;
}
.table tbody a:hover,
.table tbody a:focus {
  text-decoration: underline;
  outline: none;
}
.table tbody a:active {
  opacity: 0.8;
}

/* ===== ボタン ===== */
button {
  display: inline-block;
  background: #355C7D;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 0.5rem 1.2rem;
  font-size: 0.9rem;
  margin-bottom: 1rem;
  cursor: pointer;
  transition: background 0.3s;
}
button:hover {
  background: #355C7D;
}

  </style>
<body>
  <main class="glass-box">
    <h1>応募者スコア一覧</h1>

    <button id="reloadBtn">再読込</button>
    <table id="tbl" class="table">
      <thead>
        <tr>
          <th>順位</th>
          <th>Applicant ID</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>
</body>
<script type="module">
  import { db } from "./js/firebase.js";
import {
  collection, query, orderBy, getDocs, limit
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const tbl = document.querySelector("#tbl tbody");
const reloadBtn = document.getElementById("reloadBtn");

/** 1行（リンク付き）を生成 */
function rowFrom(docSnap, rank) {
  const d = docSnap.data() || {};
  const id = docSnap.id;
  const score = Number(d?.skill?.score ?? 0);

  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${rank}</td>
    <td><a href="detail.html?regNo=${encodeURIComponent(id)}">${id}</a></td>
    <td style="text-align:right;font-weight:600">${score}</td>
  `;
  return tr;
}

/** スコア降順で読み込み */
async function loadScores() {
  if (!tbl) return;
  tbl.innerHTML = "<tr><td colspan='3'>読み込み中...</td></tr>";

  const q = query(
    collection(db, "applicants"),
    orderBy("skill.score", "desc"),
    limit(50)
  );
  const snap = await getDocs(q);

  tbl.innerHTML = "";

  let rank = 1;
  snap.forEach((docSnap) => {
    // score が無い人を除外したい場合は下1行を有効化
    // if (docSnap.data()?.skill?.score == null) return;
    tbl.appendChild(rowFrom(docSnap, rank++));
  });

  if (rank === 1) {
    tbl.innerHTML = "<tr><td colspan='3'>データがありません</td></tr>";
  }
}

reloadBtn?.addEventListener("click", loadScores);
document.addEventListener("DOMContentLoaded", loadScores);

</script>
</html>
